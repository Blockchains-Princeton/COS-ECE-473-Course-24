# Assignment 5: Integrating your synthetic Dapp

Welcome to the last part of this project! So far you have completed all the contracts in Solidity needed for your Dapp, the last step is to integrate them with a web client to complete the end product. At the end of this part, you will get your first comprehensive decentralized application. Don't forget to give it an awesome name and slogan!

## Contracts
The first thing you need to do is to prepare all contracts in the `contracts/` directory. Recall you have implemented the following contracts:

```
Tokens (Assignment1)
├── EUSD
└── sAsset
    ├── sBNB
    └── sTSLA

Applications
├── IPriceFeed (Assignment2)
|   ├── BNBPriceFeed
|   └── TSLAPriceFeed
├── IMint (Assignment3)
└── Swap (Assignment4)
```
You only need to copy and paste the `Mint.sol` and `Swap.sol` contracts to the corresponding files. The rest of them are provided. We use constant price feeds to simplify local testing in this part and you should replace them with what you have implemented in Assignment 2 when working with a testnet or mainnet.

Then you need to compile and deploy the contracts in a local blockchain by running the following commands:
1. Run `ganache-cli` to simulate a node on your local blockchain.
2. `cd Assignment5` and run `npm install` to install openzeppelin packages.
3. Run `truffle compile && truffle deploy` to compile and deploy all contracts.


## Web client

Next you are going to finish the JavaScript functions in `app/src/index.js` to create a web client interacting with your contracts. We use truffle and webpack to compile and build the app. Before you start, run the following commands:

1. Open MetaMask in your browser, and switch the network to *Localhost 8545*.
2. Click the avatar at the top right corner, select *Import Account*, and enter the private key string of the **first** account generated by ganache (it can be found in the outputs of ganache-cli). You will see the imported account with some balance (<100ETH) in the account list. 
3. `cd app && npm install` to install web3 and webpack modules.
4. Run `npm run dev` to build the app and serve it on localhost.
5. Now open http://127.0.0.1:8080, this will launch a popup page to connect with your account.
6. After the account is connected, you need to confirm several transactions to finish the setup. These transactions are used to grant roles to the Mint contract and register two sAssets.


Now the application is running, by clicking three tabs (Mint, Pool, Swap) you can see the basic user interfaces. For example, if you select `sTSLA` and click the *Check price* button under the Mint tab, the latest price (1008.85500000) of `sTSLA` will be displayed. The functions used to interact with the contracts are defined in `app/src/index.js` and you can check how they are used in `app/src/index.html`. Some functions are already implemented, your task is to complete the rest of them according to the following specifications. 

### Mint
* `openPosition`: get the inputs from the client with element id `(sAsset, deposit, CR)`, approve the transfer of collateral tokens and call `openPosition` of the `Mint` contract with specified parameters. Update the balances at the end.

Other functions such as `closePosition`, and `deposit / withdraw` are not required in this project.

### Pool

* `addLiquidity`: get the inputs from the client with element id `(liquidity0, liquidity1)`, approve the transfer of sAsset tokens and call `addLiquidity` of `Swap` contract with specified parameters. Update the balances at the end.
* `removeLiquidity`: get the input from the client with element id `shares`, call `removeLiquidity` of `Swap` contract with the specified parameter. Update the balances at the end.

### Swap
* `token0To1 / token1To0`: get the inputs from the client with element id `swap0 / swap1`, approve the transfer of sAsset tokens, and call `token0To1 / token1To0` of the `Swap` contract with specified parameters. Update the balances at the end.

## Tips 
1. Every time you run `ganache-cli` it will generate a new list of accounts. To avoid importing new accounts to MetaMask, you can save the mnemonic (in the output of ganache) and run `ganache-cli -m "mnemonic phrases"` to keep the same list of accounts. But the states of the blockchain won't be saved.
2. `init` function has been implemented as an example showing how a function gets the inputs, calls functions in smart contracts, and writes the outputs back to the web client.
3. You can change a cooler name and slogan of your app in `app/scr/index.html`. Remember not to modify other codes.
4. For debugging, you can open the browser developer console to view any errors and warnings.

## Submission
Rename the `index.js` to `netid.js` and upload it to [this form](https://forms.gle/vKicaicGtA5oS5pYA).

## Demo

You can run a demo by checking that your web client can do the following things:

1. Mint sAsset by clicking the *Open position* button.
2. Add liquidity with correct input amounts by clicking the *Add liquidity* button.
3. Remove liquidity with valid input shares by clicking the *Withdraw* button.
4. Swap between two sAssets by clicking the *Swap* button.

All the above operations should result in reasonable balances / reserves changes. Besides, the following behaviors should be rejected:

1. All operations with insufficient funds, e.g. the amount of collateral tokens to deposit exceeds the balance.
2. All operations with incorrect ratios, e.g. collateral ratio that does not exceed MCR, add liquidity with inequivalent values.
3. Add liquidity before initializing the pool.
4. Remove liquidity with more shares than owned.



